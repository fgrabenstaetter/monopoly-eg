<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: game/player.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: game/player.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const Constants  = require('../lib/constants');
const Properties = require('../lib/properties');

/**
 * Représente un joueur dans une partie
 */
class Player {
    /**
     * @param user L'utilisateur associé au joueur
     * @param pawn Son pion
     */
    constructor (user, pawn) {
        this.user       = user;
        this.pawn       = pawn;
        this.isReady    = false; // synchronisation de tous les joueurs avant lancement de partie
        this.failure    = false;
        this.connected  = true; // false si déconnexion
        this.hasLeft    = false; // true si il quitte = rage quit volontaire
        this.money      = Constants.GAME_PARAM.PLAYER_INITIAL_MONEY;
        this.cellPos    = 0;
        this.properties = [];
        this.failureTime = null;

        this.nbJailEscapeCards    = 0;
        this.remainingTurnsInJail = 0;
    }

    /**
     * @returns un dictionaire JSON avec les donnees du joeur
     */
    toJSON () {
        let properties = [];
        for (let property of this.properties)
            properties.push(property.toJSON());

        return {
            nickname             : this.nickname,
            id                   : this.id,
            pawn                 : this.pawn,
            money                : this.money,
            cellPos              : this.cellPos,
            nbJailEscapeCards    : this.nbJailEscapeCards,
            remainingTurnsInJail : this.remainingTurnsInJail,
            properties           : properties
        }
    }

    /**
     * @returns true si le joueur est en prison, false sinon
     */
    get isInPrison () {
        return this.remainingTurnsInJail > 0;
    }

    /**
     * @returns le nombre de gares que possède le joueur
     */
    get trainStationsNb () {
        let nb = 0;
        for (const prop of this.properties)
            if (prop.type === Constants.PROPERTY_TYPE.TRAIN_STATION)
                nb ++;

        return nb;
    }

    /**
     * @returns true si le joueur a toutes les compagnies, false sinon
     */
    get haveAllCompanies () {
        let nb = 0;
        for (const prop of this.properties)
            if (prop.type === Constants.PROPERTY_TYPE.PUBLIC_COMPANY)
                nb ++;

        return nb === Properties.PUBLIC_COMPANY.length;
    }

    get id () {
        return this.user.id;
    }

    get nickname () {
        return this.user.nickname;
    }

    get socket () {
        return this.user.socket;
    }

    addMoney (amount) {
        this.money = this.money + amount;
    }

    loseMoney (amount) {
        if(this.money &lt; amount) {
            this.money = 0;
            return false;
        } else {
            this.money = this.money - amount;
            return true;
        }
    }

    goPrison () {
        this.moveAbsolute(10);
        this.remainingTurnsInJail = 3;
    }

    quitPrison () {
        this.remainingTurnsInJail = 0;
    }

    /**
     * @param property La propriété à ajouter au joueur
     */
    addProperty (property) {
        property.owner = this;
        this.properties.push(property);
    }

    /**
     * @param property La propriété à supprimer du joueur
     */
    delProperty (property) {
        const ind = this.properties.indexOf(property);
        if (ind !== -1) {
            this.properties.splice(ind, 1);
            property.owner = null;
        }
    }

    /**
     * @param id L'ID de la propriété à chercher
     * @returns La propriété si trouvée, sinon false
     */
    propertyByID (id) {
        for (const prop of this.properties) {
            if (prop.id === id)
                return prop;
        }

        return false;
    }

    getPropertiesByType (type) {
        let properties = [];
        for (const property of this.properties)
            if (property.type == type)
                properties.push(property);

        return properties;
    }

    /**
     * @param color La couleur recherchée de type PROPERTY_COLOR (constants)
     * @returns true si le joueur possède toutes les rues de cette couleur, false sinon
     */
    colorMonopoly (color) {
        let nb = 0, total = 0;

        for (const prop of this.properties) {
            if (prop.type === Constants.PROPERTY_TYPE.STREET &amp;&amp; prop.color === color)
                nb ++;
        }
        for (const prop of Properties.STREET) {
            if (prop.color === color)
                total ++;
        }

        return nb === total &amp;&amp; nb > 0;
    }

    /**
     * @param pos Le nb de cases à avancer/reculer
     */
    moveRelative (pos) {
        this.cellPos = (this.cellPos + pos) % 40; // 40 cellules au total
    }

    /*
     * @param pos La case où aller (0 &lt;= pos &lt; 40)
     * @param passGoReward - bool, gagner ou pas de l'argent quand on passe par la cellule Go
     */
    moveAbsolute (pos) {
        this.cellPos = pos;
    }
}

module.exports = Player;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Bank.html">Bank</a></li><li><a href="Cell.html">Cell</a></li><li><a href="Chat.html">Chat</a></li><li><a href="Game.html">Game</a></li><li><a href="Lobby.html">Lobby</a></li><li><a href="Matchmaking.html">Matchmaking</a></li><li><a href="Network.html">Network</a></li><li><a href="Offer.html">Offer</a></li><li><a href="Player.html">Player</a></li><li><a href="Property.html">Property</a></li><li><a href="PublicCompany.html">PublicCompany</a></li><li><a href="Street.html">Street</a></li><li><a href="Tax.html">Tax</a></li><li><a href="TrainStation.html">TrainStation</a></li><li><a href="User.html">User</a></li><li><a href="UserManager.html">UserManager</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Sun May 03 2020 11:12:45 GMT+0200 (GMT+02:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
