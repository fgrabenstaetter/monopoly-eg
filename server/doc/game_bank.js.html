<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: game/bank.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: game/bank.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const Constants  = require('../lib/constants');
const Properties = require('../lib/properties');

/**
 * Représente la banque du jeu
 */
class Bank {

    /**
     * @param cells Toutes les cellules du jeu (liste de Cell)
     */
    constructor (cells) {
        this.money = Constants.GAME_PARAM.BANK_INITIAL_MONEY;
        this.debts = []; // array of [playerID, money]
        this.properties = [];
        for (const cell of cells)
            if (cell.property)
                this.addProperty(cell.property);
    }

    toJSON () {
        let properties = [];
        for (let property of this.properties)
            properties.push(property.toJSON());

        return {
            money: this.money,
            debts: this.debts,
            properties: properties
        }
    }

    /**
     * @param money Argent à encaisser
     */
    addMoney (money) {
        this.money += money;
    }

    /**
     * @param money Argent à retirer
     */
    loseMoney (money) {
        this.money -= money;
        if (this.money &lt; 0)
            this.money = 0; // la banque ne faillite jamais
    }

    /**
     * @param property La propriété à ajouter
     */
    addProperty (property) {
        property.owner = null;
        property.isMortgaged = false;
        if (property.type === Constants.CELL_TYPE.STREET) {
            property.housesNb = 0;
            property.hasHostel = false;
        }
        this.properties.push(property);
    }

    /**
     * @param property La propriété à retirer
     */
    delProperty (property) {
        const ind = this.properties.indexOf(property);
        if (ind !== -1)
            this.properties.splice(ind, 1);
    }

    /**
     * @param player Le joueur auquel ajouter un montant de dette
     * @param money Le montant de la dette
     */
    addDebt (player, money) {
        for (const debt of this.debts) {
            if (debt[0] === player.id) {
                // ajouter le montant à la dette actuelle
                debt[1] += money;
                return;
            }
        }

        this.debts.push([ player.id, money ]);
    }

    /**
     * @param player Le joueur qui veut être payé
     * @retrun true si le paiement a réussi, false sinon (= banque n'a pas assez d'argent)
     */
    payDebt (player) {
        for (const debt of this.debts) {
            if (debt[0] === player.id) {
                if (this.money >= debt[1]) {
                    this.loseMoney(debt[1]);
                    player.addMoney(debt[1]);
                    return true;
                } else
                    return false
            }
        }

        return false;
    }
}

module.exports = Bank;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Bank.html">Bank</a></li><li><a href="Bid.html">Bid</a></li><li><a href="Card.html">Card</a></li><li><a href="Cell.html">Cell</a></li><li><a href="Chat.html">Chat</a></li><li><a href="Deck.html">Deck</a></li><li><a href="Game.html">Game</a></li><li><a href="Lobby.html">Lobby</a></li><li><a href="Matchmaking.html">Matchmaking</a></li><li><a href="Network.html">Network</a></li><li><a href="Offer.html">Offer</a></li><li><a href="Player.html">Player</a></li><li><a href="Property.html">Property</a></li><li><a href="PublicCompany.html">PublicCompany</a></li><li><a href="Street.html">Street</a></li><li><a href="Tax.html">Tax</a></li><li><a href="TrainStation.html">TrainStation</a></li><li><a href="User.html">User</a></li><li><a href="UserManager.html">UserManager</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Sun May 03 2020 11:35:16 GMT+0200 (GMT+02:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
